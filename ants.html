<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content="jemdoc, see http://jemdoc.jaboc.net/" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="jemdoc.css" type="text/css" />
<title>A Quick Guide to ANTs</title>
<!-- MathJax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async>
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
	  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<!-- End MathJax -->
</head>
<body>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
    var pageTracker = _gat._getTracker("UA-252546838-1");
    pageTracker._trackPageview();
} catch(err) {}</script>
<table summary="Table for page layout." id="tlayout">
<tr valign="top">
<td id="layout-menu">
<div class="menu-category">Home</div>
<div class="menu-item"><a href="sws_intro.html">Intro</a></div>
<div class="menu-item"><a href="index.html">Homepage</a></div>
<div class="menu-category">Software</div>
<div class="menu-item"><a href="freesurfer.html">FreeSurfer</a></div>
<div class="menu-item"><a href="ants.html" class="current">ANTs</a></div>
<div class="menu-item"><a href="MRtrix.html">MRtrix</a></div>
<div class="menu-item"><a href="afni.html">AFNI</a></div>
<div class="menu-item"><a href="FSL.html">FSL</a></div>
<div class="menu-category">Data</div>
<div class="menu-item"><a href="dataOverview.html">Overview</a></div>
<div class="menu-item"><a href="HCP.html">HCP</a></div>
</td>
<td id="layout-content">
<div id="toptitle">
<h1>A Quick Guide to ANTs</h1>
</div>
<h2>Installation on macOS</h2>
<p>Before running the following commands, you should have XCode and CMake installed. For detail requirements, see this <a href="https://github.com/ANTsX/ANTs/wiki/Compiling-ANTs-on-Linux-and-Mac-OS" target=&ldquo;blank&rdquo;>official tutorial</a>
</p>
<h3>Step 1: Download the latest code </h3>
<p>My path is set to <tt>/Users/zijianchen/Downloads</tt>. 
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
cd Downloads
git clone https://github.com/ANTsX/ANTs.git
</pre></div></div>
<p>This will create a folder called <tt>Downloads/ANTs</tt>.
</p>
<h3>Step 2: Configuration</h3>
<p>Create the <tt>/Downloads/build</tt> and <tt>/Downloads/install</tt> folder:
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
mkdir build install
</pre></div></div>
<p>Open configuration panel:
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
cd build
ccmake ../ANTs
</pre></div></div>
<p>Press 'c&rsquo; to do an initial configuration. There are three places you may need to modify:
</p>
<ul>
<li><p><tt>CMAKE_INSTALL_PREFIX</tt>: This is the path that you want to install ANTs. This is set to <tt>/opt/ANTs</tt> by default. You may encounter some issues if you use this path (no access to write even with <tt>sudo</tt>). I set this to <tt>/Users/zijianchen/ants</tt> which works well.
</p>
</li>
<li><p><tt>RUN_LONG_TESTS</tt>: set this to 'OFF&rsquo;
</p>
</li>
<li><p><tt>RUN_SHORT_TESTS</tt>: set this to 'OFF&rsquo;
</p>
</li>
</ul>
<table class="imgtable"><tr><td>
<img src="./figs/ants_install_1.png" alt="" width="50%" />&nbsp;</td>
<td align="left"></td></tr></table>
<p>When you complete everything, press 'g&rsquo;.
</p>
<h3>Step 3: Build and install</h3>
<p>Build (this will create a subdirectory <tt>/Downloads/build/ANTS-build</tt> ):
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
make 2&gt;&amp;1 | tee build.log
</pre></div></div>
<p>Install (This will copy the binaries and libraries to bin/ and lib/ under <tt>CMAKE_INSTALL_PREFIX</tt> (which is set to be <tt>/Users/zijianchen/ants</tt> as mentioned previously).):
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
cd ANTS-build
make install 2&gt;&amp;1 | tee install.log
</pre></div></div>
<h3>Step 4: Set environment variables </h3>
<p>Run the following commands each time you initiate bash.
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
export ANTSPATH=/Users/zijianchen/ants/bin
export PATH=${ANTSPATH}:$PATH
</pre></div></div>
<p>To check whether this worked correctly, type <tt>which antsRegistration</tt>, and it should return <tt>/Users/zijianchen/ants/bin/antsRegistration</tt>.
</p>
<p>Alternatively, if you want to configure this once and for all, add the above lines at the bottom of your <tt>~/.bashrc</tt> (or <tt>~/.bash_profile</tt>) file so that they will be executed each time you open bash. 
</p>
<h2>Usage</h2>
<p>You only need two commands to perform registration. Go into the folder that contains 
</p>
<ul>
<li><p>target image (<a href="files/MNI152_T1_2009c.nii" target=&ldquo;blank&rdquo;>MNI152_T1_2009c.nii</a>, converted from <a href="https://afni.nimh.nih.gov/pub/dist/atlases/MNI_HCP/MNI_Glasser_HCP_2019_v1.0/" target=&ldquo;blank&rdquo;>HEAD/BRIK file from AFNI database</a>)
</p>
</li>
<li><p>source image to be registered (I am using the sculp stripped verson of <tt>sub-PA01_ses-3TB1_acq-r10x10x10_T1w_defaced.nii</tt>)
</p>
</li>
</ul>
<p>The first command is to generate the transformation matrix
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
antsRegistrationSyN.sh -d 3 \
                       -o ./ants \
                       -f MNI152_T1_2009c.nii \
                       -m subj1_T1.nii
</pre></div></div>
<p>Parameters:
</p>
<ul>
<li><p><tt>-d</tt>: dimension of the image (for <tt>.nii</tt> figures, the dimension is 3)
</p>
</li>
<li><p><tt>-o</tt>: output file name prefix (all output file will look like <tt>antsxxxxx</tt>). 
</p>
</li>
<li><p><tt>-f</tt>: the fixed image
</p>
</li>
<li><p><tt>-m</tt>: the moving image
</p>
</li>
</ul>
<p>This step could take approximately 1 hour and should produce the following files (using 'ants&rsquo; as the prefix):
</p>
<ul>
<li><p>ants0GenericAffine.mat
</p>
</li>
<li><p>ants1InverseWarp.nii.gz
</p>
</li>
<li><p>ants1Warp.nii.gz
</p>
</li>
<li><p>antsInverseWarped.nii.gz
</p>
</li>
<li><p>antsWarped.nii.gz
</p>
</li>
</ul>
<p>The second command is to apply thr transformation:
</p>
<div class="codeblock">
<div class="blockcontent"><pre>
antsApplyTransforms -d 3 \
                    -i subj1_T1.nii \
                    -r MNI152_T1_2009c.nii \
                    -n GenericLabel[Linear] \
                    -t ./ants1Warp.nii.gz -t ./ants0GenericAffine.mat \
                    -o ./sub_to_MNI152.nii.gz
</pre></div></div>
<p>New parameters:
</p>
<ul>
<li><p><tt>-i</tt>: input images
</p>
</li>
<li><p><tt>-r</tt>: reference image (target image)
</p>
</li>
<li><p><tt>-n</tt>: interpolation options
</p>
</li>
<li><p><tt>-t</tt>: transform file name. 
</p>
</li>
</ul>
<table class="imgtable"><tr><td>
<img src="./figs/ants_demo_1.png" alt="" width="50%" />&nbsp;</td>
<td align="left"></td></tr></table>
<div id="footer">
<div id="footer-text">
Page generated 2023-08-12 23:40:31 EDT.
</div>
</div>
</td>
</tr>
</table>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-EZMPZ1N19T"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-EZMPZ1N19T');
</script>
</body>
</html>
