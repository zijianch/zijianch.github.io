<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
  "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta name="generator" content="jemdoc, see http://jemdoc.jaboc.net/" />
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="jemdoc.css" type="text/css" />
<title>Wasserstein Distance (Optimal Transport Problem)</title>
<!-- MathJax -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async>
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
	  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
<!-- End MathJax -->
</head>
<body>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
    var pageTracker = _gat._getTracker("UA-252546838-1");
    pageTracker._trackPageview();
} catch(err) {}</script>
<div id="layout-content">
<div id="toptitle">
<h1>Wasserstein Distance (Optimal Transport Problem)</h1>
</div>
<div class="infoblock">
<div class="blockcontent">
<p>This page is currently under construction.
</p>
</div></div>
<h2>Formulation</h2>
<p>The OT problem seeks to answer this question: <i>How do you best move given piles of sand to fill up given holes (in another place) of the same total volume?</i> Let's translate this into math (see <a href="https://www.math.ucdavis.edu/~qlxia/Research/monge.pdf" target=&ldquo;blank&rdquo;>these slides</a>): 
</p>
<ul>
<li><p>&ldquo;piles of sand&rdquo;: a positive measure \(\mu\) defined on \(X\)
</p>
</li>
<li><p>&ldquo;holes (in another place)&rdquo;: another positive measure \(\nu\) defined on \(Y\)
</p>
</li>
<li><p>&ldquo;same total volume&rdquo;: usually we restrict \(\mu\) and \(\nu\) to be probability measures (so the total volume is 1)
</p>
</li>
<li><p>&ldquo;best&rdquo;: the total cost to move should be minimized. The cost for moving 1 unit of mass from \(x\in X\) to \(y\in Y\) is \(c(x,y)\).
</p>
</li>
</ul>
<p>Under different formulations, interpretations of the following words/phrases may differ:
</p>
<ul>
<li><p>&ldquo;move&rdquo;: transport maps (a measurable map \(F\)) or transport plans (probability measure \(\gamma\))
</p>
</li>
<li><p>&ldquo;fill up&rdquo;: \(F_{\#}\mu = \nu\) for transport maps and \(\left(\pi_X\right)_{\#} \gamma=\mu\), \(\left(\pi_Y\right)_{\#} \gamma=\nu\) for transport plans.
</p>
</li>
</ul>
<h3>Monge's formulation</h3>
<p>Given two measure space \((X,\mu)\) and \((Y,\nu)\), we define a measurable map \(F:X\to Y\) with
</p>
<p style="text-align:center">
\[
F_{\#}\mu = \nu, \quad \text{i.e., }\; \int_{F^{-1}(A)}  \mathrm d \mu(x) = \int_A \mathrm d \nu(y) \quad \forall \text{ measurable } A\in Y.
\]
</p><p>This is also known as the &ldquo;pushfoward of \(\mu\)&rdquo;, or the &ldquo;transport map&rdquo;. The Monge's formulation for the OT problem is
</p>
<p style="text-align:center">
\[
\min_{F} \int_X c\big(x,F(x)\big) \mathrm d \mu(x),
\]
</p><p>where \(c:X\times Y\to \mathbb{R}^+\) is the cost of transportation. 
</p>
<p>However, the problem is not well-posed in a sense that there may not always be a transport map for two given measures, since each particle must be moved as a whole. For example, it cannot deal with cases where numbers of particles (with positive mass) are not equal (e.g., \(X=[-1,1]\), \(\mu=\delta_0\), \(\nu=\frac{\delta_{-1}+\delta_{1}}{2}\)).
</p>
<h3>Kantorovich's formulation</h3>
<p>Instead of defining the transport map, Kantorovich proposed the &ldquo;transport plan&rdquo; which allows particles to be split and moved to different places (&ldquo;Kantorovich's relaxation&rdquo;). It is a probability measure \(\gamma\in X\times Y\) with marginals \(\mu\) and \(\nu\), i.e.,
</p>
<p style="text-align:center">
\[
\left(\pi_X\right)_{\#} \gamma=\mu,\quad \left(\pi_Y\right)_{\#} \gamma=\nu,
\]
</p><p>where \(\pi_X:X\times Y\to X\) and \(\pi_Y:X\times Y\to Y\) are called canonical projections. Note that there will be multiple joint distributions that correspond to the given two marginal distributions \(\mu\) and \(\nu\). We denote the set of all such joint distributions as \(\Pi(\mu,\nu)\). The Kantorovich's formulation is
</p>
<p style="text-align:center">
\[
    \min_{\gamma\in \Pi(\mu,\nu)}\int_{X\times Y} c(x,y)\mathrm d\gamma(x,y).
\]
</p><p>Since the problem is convex, the solutions for the dual and the primal problem will be the same. So we have 
<a href="https://en.wikipedia.org/wiki/Wasserstein_metric#Dual_representation_of_W1" target=&ldquo;blank&rdquo;>Kantorovich's dual formulation</a>. 
</p>
<h3>Relationship between these two formulations</h3>
<p>If a transport map \(F\) exists, then it will induce a unique transport plan \(\gamma\) with the same cost function given by \(\gamma = (\mathrm{Id},F)_{\#}\mu\). Moreover, if \(F\) is the optimal transport map, \(\gamma\) induced by \(F\) will be the optimal transport plan. The inverse is not true: The existence of transport plans does NOT guarantee the existence of transport maps.
</p>
<p><b>Brenier's theorem</b>: If \(X=Y=\mathbb{R}^n\), \(c(x,y)=\|x-y\|^2\), \(\mu,\nu\) are with finite second-order moments and \(\mu\) is absolutely continuous, then there exist a unique optimal transport map \(F\) and a unique optimal transport plan: 
</p>
<p style="text-align:center">
\[ \int_X\|x-F(x)\|^2 \mathrm{d} \mu(x) =  \min_{\gamma\in \Pi(\mu,\nu)}\int_{X\times Y} \|x-y\|^2\mathrm d\gamma(x,y). \]
</p><p>Moreover, \(F=\nabla \phi(x)\) for some convex scalar function \(\phi: \mathbb{R}^m\to \mathbb{R}\). Note that \(\phi\) can be solved from the <a href="https://en.wikipedia.org/wiki/Monge–Ampère_equation" target=&ldquo;blank&rdquo;>Monge-Ampère equation</a> \(I_0(x)=\mathrm{det}\big(\nabla^2 \phi(x)\big)I_1\big(\nabla \phi(x)\big)\) where \(I_0\) and \(I_1\) are density functions of \(\mu\) and \(\nu\) respectively. 
</p>
<h2>Solving the problem</h2>
<p>For one dimensional problem with \(c(x,y)=|x-y|^p\), the solution is simply given as 
</p>
<p style="text-align:center">
\[
\left(\int_0^1\left|F_0^{-1}(z)-F_1^{-1}(z)\right|^p d z\right)^{\frac{1}{p}}
\]
</p><p>where \(F_0^{-1}\) and \(F_1^{-1}\) are the quantile functions (inverse CDFs).
</p>
<p>However, higher dimensional cases are more complicated and we will not have such closed form expression (except for Normal distributions).
</p>
<h3>Linear programming</h3>
<p>This solver relies on discretization. Consider the densities \(I_0(x)=\sum_{i=1}^{n_p}p_i\delta(x-x_i)\) and \(I_1(x)=\sum_{j=1}^{n_q}q_j\delta(y-y_j)\). The problem has the following form:
</p>
<p style="text-align:center">
\[
\begin{aligned}
\min_{\boldsymbol{\gamma}=(\gamma_{ij}) \in \mathbb{R}^{n_p\times n_q}} \quad &amp;\sum_{i=1}^{n_p}\sum_{j=1}^{n_q} c(x_i,y_j)\gamma_{ij}\\
\text{subject to} \quad &amp; \sum_{i=1}^{n_p} \gamma_{ij} = q_j, \quad \forall j=1,\cdots,n_q\\
 &amp; \sum_{j=1}^{n_q} \gamma_{ij} = p_i, \quad \forall i=1,\cdots,n_p\\
 &amp; \gamma_{ij}\geq 0, \quad \forall i,j.
\end{aligned}
\]
</p><p>Corresponding MATLAB codes can be downloaded here. This method is applicable to general costs, but will have great trouble when the densities are supported on a large number of sites.
</p>
<h3>Gradient Descent: using Brenier's theorem</h3>
<h3>Gradient Descent: using Kantorovich's dual formulation</h3>
<h2>Applications</h2>
<div id="footer">
<div id="footer-text">
Page generated 2022-12-20 15:19:13 CST.
</div>
</div>
</div>
</body>
</html>
